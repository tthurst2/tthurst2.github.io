<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Address Testing Page</title>
        <!-- Bootstrap Link -->
        <link rel='stylesheet' type='text/css' href='node_modules/bootstrap/dist/css/bootstrap.min.css'>
        <!-- Bootstrap Optional Theme -->
        <link rel='stylesheet' type='text/css' href='node_modules/bootstrap/dist/css/bootstrap.css'>
    </head>
    <body>
        <!-- J Query -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <!-- Future JS -->
        <script>src="js/address.js"</script>
        <!-- DOCUMENT -->
        <h2>Address API Tester</h2><br>
        Address 1:<br>
        <input type="text" id="addr1" class="inputfield" placeholder="Address 1" value="301 village drive"><br>
        Address 2:<br>
        <input type="text" id="addr2" class="inputfield" placeholder="Address 2(Apt etc)" value="344"><br>
        City:<br>
        <input type="text" id="city" class="inputfield" placeholder="City" value="king of prussia"><br>
        State:<br>
        <input type="text" id="state" class="inputfield" placeholder="State" value="Pennsylvania"><br>
        Zip:<br>
        <input type="text" id="zip1" class="inputfield" placeholder="Zipcode" value="19406"><br>
        <input type="button" onclick="validateAddress()" value="Validate">
        <script>

        function validateAddress() {
            var user_id = "729UHS005798";
            var schemeHost = "https://secure.shippingapis.com";
            var addr1 = document.getElementById("addr1").value;
            var addr2 = document.getElementById("addr2").value;
            var city = document.getElementById("city").value;
            var state = document.getElementById("state").value;
            var zip1 = document.getElementById("zip1").value;
            var fullURL = 'https://secure.shippingapis.com/ShippingAPITest.dll?API=Verify&XML=<AddressValidateRequest USERID="729UHS005798" ><Address ID="0"><Address1>301 Village Drive</Address1><Address2>344</Address2><City>King of Prussia</City><State>PA</State><Zip5>19406</Zip5><Zip4></Zip4></Address></AddressValidateRequest>'
            /* Object to get USPS informatoin */
            var xhr = new XMLHttpRequest();
            var inputParse = new DOMParser();
            //change colors for niceness
            // url for USPS
            var url = schemeHost + '/ShippingAPITest.dll?API=Verify&XML=<AddressValidateRequest USERID="' + user_id + '" ><Address ID="0"><Address1>' + addr1 + '</Address1><Address2>' + addr2 + '</Address2><City>' + city + '</City><State>' + state + '</State><Zip5>' + zip1 + '</Zip5><Zip4></Zip4></Address></AddressValidateRequest>';
            console.log(inputParse.parseFromString(fullURL, "text/xml"));
            
            //creating the XHR
            xhr.open("POST", url, true);
            // handle response
            xhr.onreadystatechange = function() {
                if(this.status == 200 && this.readyState === this.DONE) {
                    var parser = new DOMParser();
                    var xmlDoc = parser.parseFromString(this.responseText, "text/xml");    
                    //console.log(xhr);        
                    //console.log(xmlDoc);
                    /* Populate fields from USPS return */
                    if(xmlDoc.getElementsByTagName("Error")[0] != null) {
                        alert(xmlDoc.getElementsByTagName("Description")[0].innerHTML);
                    }
                    else if(xmlDoc.getElementsByTagName("ReturnText")[0] != null) {
                            alert(xmlDoc.getElementsByTagName("ReturnText")[0].innerHTML);
                        }
                    else {
                        //if the tag exists
                        if(xmlDoc.getElementsByTagName("Address1").length)
                            document.getElementById("addr1").value = xmlDoc.getElementsByTagName("Address1")[0].innerHTML;   
                        else document.getElementById("addr1").value = "";
                        if(xmlDoc.getElementsByTagName("Address2").length)
                            document.getElementById("addr2").value = xmlDoc.getElementsByTagName("Address2")[0].innerHTML;
                            else document.getElementById("addr2").value = "";  
                        //simple checks  
                        if(xmlDoc.getElementsByTagName("City").length) {
                            document.getElementById("city").value = xmlDoc.getElementsByTagName("City")[0].innerHTML;
                        }
                        if(xmlDoc.getElementsByTagName("State").length) {
                        document.getElementById("state").value = xmlDoc.getElementsByTagName("State")[0].innerHTML;
                        }
                        if(xmlDoc.getElementsByTagName("Zip5").length) {
                        document.getElementById("zip1").value = xmlDoc.getElementsByTagName("Zip5")[0].innerHTML;
                        }
                        $(".inputfield").css("background-color", "PowderBlue");
                        }
                              
                }
            }
            //send 
            xhr.send(url);
        }

        /* Function to create XML request tags and bodies... maybe */
        function createRequest()  {
            var xmlReq = '';
        }
        </script>
    </body>
</html>